!function(){"use strict";function a(){function a(a,b){var c=typeof a,d=typeof b;return"function"===c||c===d&&(a&&"object"===c?a.toString()===b.toString():a===b)}var b=this;this.any=function(a){return b.matchUsing(function(b){return"string"==typeof a?typeof b===a:b instanceof a})},this.is=function(a,c){return b.matchUsing(function(d){var e=b.any(a)(d),f=!1;return e&&(f="function"==typeof c&&"function"!=typeof a&&"function"!==a?c(d):d===c),e&&f})},this.hasState=function(c){return b.matchUsing(function(b){if("object"!=typeof b)return!1;for(var d in c)if(c.hasOwnProperty(d)&&"function"!=typeof c[d]&&(!b.hasOwnProperty(d)||!a(c[d],b[d])))return!1;return!0})},this.hasProperty=function(a,c){return b.matchUsing(function(b){return"object"==typeof b&&void 0!==b[a]&&b[a]===c})},this.matchUsing=function(a){if("function"!=typeof a||1!==a.length)throw new Error("matchUsing requires a function that accepts a single argument.");var b=a(void 0);if("boolean"!=typeof b)throw new Error("matchUsing requires a function that returns a boolean result.");return a.isMatcher=!0,a}}function b(a){var b,c,d=!1,e=!1;a&&(e=a),this.then=function(a,e){d=!0,b=a,c=e},this.success=function(a){b&&b(a)},this.error=function(a){c&&c(a)},this.receivedThen=function(){if(this.throwsErrors()&&d===!1)throw new Error("then has not received expected call");return d},this.receivedThenWithOneHandler=function(){var a=d&&"function"==typeof b;if(this.throwsErrors()&&a===!1)throw new Error("then has not been called with expected success handler");return a},this.receivedThenWithBothHandlers=function(){var a=d&&"function"==typeof b&&"function"==typeof c;if(this.throwsErrors()&&a===!1)throw new Error("then has not been called with expected success and error handlers");return a},this.hasSuccessHandler=function(){var a="function"==typeof b;if(this.throwsErrors()&&a===!1)throw new Error("Promise does not have expected success handler");return a},this.hasErrorHandler=function(){var a="function"==typeof c;if(this.throwsErrors()&&a===!1)throw new Error("Promise does not have expected error handler");return a},this.throwErrors=function(a){void 0===a&&(a=!0),e=a},this.throwsErrors=function(){return e}}function c(a,b){var c,d=[],e=[];this.name=a,this.canCallThrough=function(){return"object"==typeof b&&"function"==typeof b[a]},this.callThrough=function(c){return b[a].apply(b,c)},this.addCall=function(a){d.push(a)},this.clearCalls=function(){d=[]},this.callCount=function(){return d.length},this.getArgs=function(a){return void 0===a&&(a=d.length-1),d[a]},this.hasCallWithArgs=function(a){for(var b=0;b<d.length;b++)if(i(d[b],a))return!0;return!1},this.addReturn=function(a,b){e.push({returnValue:a,args:b})},this.getReturnForArgs=function(a){if(0!==e.length){if(a&&a.length>0)for(var b=e.length-1;b>=0;b--)if(i(a,e[b].args))return e[b].returnValue;return e[e.length-1].returnValue}},this.setCallsThrough=function(){c=!0},this.getCallsThrough=function(){return c},this.getActualCallsString=function(){return h(d,this.name)}}function d(){var a=[];this.add=function(b){a.push(b)},this.get=function(b){for(var c=0;c<a.length;c++){var d=a[c];if(d&&d.name===b)return d}throw new Error(b+" is not being tracked by this substitute, check it exists at the time the substitute was created")}}function e(a,e){function f(a){return function(){var b=l.get(a),c=g(arguments,0);if(b.addCall(c),b.getCallsThrough())return b.callThrough(c);var d=b.getReturnForArgs(c);return d?d:void 0}}function h(a,b){var d=new c(a,b);l.add(d),k[a]=f(a)}function i(a){for(var b in a)if(a.hasOwnProperty(b)){var c=typeof a[b];"function"!==c?k[b]=a[b]:h(b,a)}}function j(a){for(var b=0;b<a.length;b++)h(a[b],a[b])}var k=this,l=new d;this.throwsErrors=function(){return e},this.received=function(a,b){var c=l.get(a),d=!0,f=c.callCount();isNaN(b)&&(b=1,d=!1);var g=d&&f===b||f>=b;if(!g&&e)throw new Error(a+" did not receive the expected "+b+" calls, actually received "+c.callCount()+" calls.");return g},this.receivedWith=function(a){var b=l.get(a),c=g(arguments,1),d=b.hasCallWithArgs(c);if(!d&&e)throw new Error(a+" did not receive a call with the expected arguments.\n"+b.getActualCallsString());return d},this.didNotReceive=function(a){var b=l.get(a),c=b.callCount(),d=0===c;if(!d&&e)throw new Error(a+" received "+c+" unexpected calls to "+a);return d},this.returns=function(a,b){var c=l.get(a);c.addReturn(b)},this.returnsFor=function(a,b){var c=l.get(a),d=g(arguments,2);c.addReturn(b,d)},this.returnsPromise=function(a,c){c||(c=this.throwsErrors());var d=l.get(a),e=new b(c);return d.addReturn(e),e},this.returnsPromiseFor=function(a){var c=l.get(a),d=g(arguments,1),e=new b(this.throwsErrors());return c.addReturn(e,d),e},this.callsThrough=function(a){var b=l.get(a);if(!b.canCallThrough())throw new Error("Cannot call through as substitute was not created from an object with a method of this name");b.setCallsThrough()},this.argsForCall=function(a,b){var c=l.get(a),d=c.callCount();if(0===d)throw new Error("No calls received for "+a);void 0===b&&(b=d-1);for(var e=c.getArgs(b),f=[],g=0;g<e.length;g++)f.push(e[g]);return f},this.clearCalls=function(a){var b=l.get(a);b.clearCalls()},this.getActualCallsString=function(a){var b=l.get(a);return b.getActualCallsString()},this.invokeArgOfLastCallWith=function(a,b){var c=l.get(a),d=g(arguments,2),e=c.getArgs()[b];if("function"!=typeof e)throw new Error("Cannot invoke argument "+b+" of "+a+", it is not a function");e.apply(null,d)},this.invokeArgOfCallWith=function(a,b,c){var d=l.get(a),e=g(arguments,3),f=d.getArgs(b)[c];if("function"!=typeof f)throw new Error("Cannot invoke argument "+c+" of call "+b+" of "+a+", it is not a function");f.apply(null,e)},a instanceof Array?j(a):i(a)}function f(){function c(a){if(!(a instanceof Array))return!1;for(var b=0;b<a.length;b++)if("string"!=typeof a[b])return!0;return!1}var d=!1;this["for"]=function(a,b){void 0===b&&(b=d);var f=typeof a;if(c(a)||"object"!==f)throw new Error("jsSubstitute.for can only create substitutes for objects or an array of method names. To test a function try jsSubstitute.forFunction.");return new e(a,b)},this.forPromise=function(a){return a||(a=d),new b(a)},this.throwErrors=function(a){void 0===a&&(a=!0),d=a},this.throwsErrors=function(){return d},this.forFunction=function(a,b){function c(a){return void 0===a&&(a=k.length-1),k[a]}function e(a){if(!k.length)return!1;for(var b=0;b<k.length;b++)if(i(k[b],a))return!0;return!1}var f,k=[],l=j(a),m=[];b||(b=d);var n=function(){var b=g(arguments,0);if(k.push(b),f)return f;if(m.length)for(var c=g(arguments,0),d=0;d<m.length;d++){var e=m[d];if(i(e.args,c))return e.returns}return a.apply(b)};return n.wasInvoked=function(a){a||(a=1);var c=k.length===a;if(!c&&b)throw new Error(l+" was not invoked "+a+" times as expected");return c},n.wasInvokedWith=function(){var a=g(arguments,0),c=e(a);if(!c&&b)throw new Error(l+" was not invoked with the expected arguments.\n"+h(k,l));return c},n.wasNotInvokedWith=function(){var a=g(arguments,0),c=e(a);if(c&&b)throw new Error(l+" received an unexpected a call with the specified arguments.\n"+h(k,l));return c===!1},n.returns=function(a){f=a},n.returnsFor=function(a){var b=g(arguments,1);m.push({args:b,returns:a})},n.invokeArgOfLastCallWith=function(a){var b=c(),d=g(arguments,1),e=b[a];if("function"!=typeof e)throw new Error("Cannot invoke argument "+a+" of "+l+", it is not a function");e.apply(null,d)},n.invokeArgOfCallWith=function(a,b){var d=c(a),e=g(arguments,2),f=d[b];if("function"!=typeof f)throw new Error("Cannot invoke argument "+b+" of call "+a+" of "+l+", it is not a function");f.apply(null,e)},n},this.arg=new a}function g(a,b){var c=[];if(a&&a.length)for(var d=b;d<a.length;d++)c.push(a[d]);return c}function h(a,b){var c="";if(0===a.length)c="No actual calls were received";else{c="Actual call/s :";for(var d=0;d<a.length;d++)c+="\n    "+(d+1)+": "+b+" (",a[d].length&&(c+=a[d].join(", ")),c+=");"}return c}function i(a,b){if(!a)return!1;if(!b)return!1;if(a.length)for(var c=0;c<a.length;c++){var d=a[c],e=b[c],f=!1;if(f="function"==typeof e&&e.isMatcher?e(d):e===d,!f)return!1}return!0}function j(a){var b=a.toString();return b=b.substr("function ".length),b=b.substr(0,b.indexOf("(")),b||(b="anonymous function"),b}var k=new f;"undefined"!=typeof window?window.substitute=k:"function"==typeof require&&("function"==typeof define?define([],function(){return k}):module.exports=k)}();